<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üî• Free Fire UID Tracker</title>
  <link rel="stylesheet" href="style.css">
  <script>
    async function trackUID(event) {
      if (event) event.preventDefault();
      let uid = document.querySelector("input[name='uid']").value;
      if (!uid) return;

      // First request: player data
      let res = await fetch("https://gagan-info-v1.vercel.app/info?uid=" + uid);
      let info = await res.json();
      let player = info.playerData;
      let guild = info.guildInfo;
      let pet = info.petInfo;

      // Dates
      let now = new Date();
      let createAt = player.createAt ? new Date(parseInt(player.createAt) * 1000) : "N/A";
      let lastLogin = player.lastLoginAt ? new Date(parseInt(player.lastLoginAt) * 1000) : "N/A";
      let diff = (player.lastLoginAt) ? Math.floor((now - lastLogin) / 1000) : null;

      // Online status
      let status = "N/A";
      if (diff !== null) {
        status = (diff <= 300) ? "üü¢ Online" : 
          `üî¥ Offline (${diff >= 86400 ? Math.floor(diff/86400) + "d " : ""}${Math.floor((diff % 86400)/3600)}h ${Math.floor((diff % 3600)/60)}m ago)`;
      }

      // üéØ XP Tracker
      let todayKey = "xp_start_" + uid + "_" + now.toDateString();
      let xpStart = localStorage.getItem(todayKey);
      if (!xpStart) {
        localStorage.setItem(todayKey, player.exp);
        xpStart = player.exp;
      }
      let xpGained = player.exp - xpStart;

      // Clan Leader Data (second request if clan exists)
      let clanLeaderCard = "";
      if (guild && guild.captainId) {
        let resLeader = await fetch("https://gagan-info-v1.vercel.app/info?uid=" + guild.captainId);
        let leaderInfo = await resLeader.json();
        let leader = leaderInfo.playerData;

        let leaderLastLogin = leader.lastLoginAt ? new Date(parseInt(leader.lastLoginAt) * 1000) : "N/A";
        let leaderDiff = (leader.lastLoginAt) ? Math.floor((now - leaderLastLogin) / 1000) : null;
        let leaderStatus = "N/A";
        if (leaderDiff !== null) {
          leaderStatus = (leaderDiff <= 300) ? "üü¢ Online" : 
            `üî¥ Offline (${leaderDiff >= 86400 ? Math.floor(leaderDiff/86400) + "d " : ""}${Math.floor((leaderDiff % 86400)/3600)}h ${Math.floor((leaderDiff % 3600)/60)}m ago)`;
        }

        clanLeaderCard = `
          <div class="card leader-card">
            <h3>üëë Clan Leader Info</h3>
            <p><b>Name:</b> ${leader.nickname} (Lvl ${leader.level})</p>
            <p><b>UID:</b> ${leader.accountId}</p>
            <p><b>Region:</b> ${leader.region}</p>
            <p><b>Status:</b> <span class="status">${leaderStatus}</span></p>
          </div>
        `;
      }

      // UI Cards
      document.querySelector("#result").innerHTML = `
        <div class="card player-card">
          <h2>${player.nickname} <span class="level">Lvl ${player.level}</span></h2>
          <p><b>UID:</b> ${player.accountId}</p>
          <p><b>Region:</b> ${player.region}</p>
          <p><b>Status:</b> <span class="status">${status}</span></p>
        </div>

        <div class="card stats-card">
          <h3>üìä Player Stats</h3>
          <div class="stats-grid">
            <div><b>Experience</b><br>${player.exp}</div>
            <div><b>Rank Points</b><br>${player.rankingPoints}</div>
            <div><b>Rank</b><br>${player.rank}</div>
            <div><b>CS Rank</b><br>${player.csRank}</div>
          </div>
        </div>

        <div class="card xp-card">
          <h3>‚ö° XP Tracker (Today)</h3>
          <div class="stats-grid">
            <div><b>Starting XP</b><br>${xpStart}</div>
            <div><b>Current XP</b><br>${player.exp}</div>
            <div><b>XP Gained</b><br style="color:#00ff9d;">${xpGained}</div>
          </div>
        </div>

        <div class="card guild-card">
          <h3>üèÜ Guild Info</h3>
          ${guild ? `
            <p><b>Clan:</b> ${guild.clanName} (Lvl ${guild.clanLevel})</p>
            <p><b>Members:</b> ${guild.memberNum}/${guild.capacity}</p>
          ` : "<p>No guild data</p>"}
        </div>

        ${clanLeaderCard}

        <div class="card pet-card">
          <h3>üêæ Pet Info</h3>
          ${pet ? `
            <p><b>Pet ID:</b> ${pet.id}</p>
            <p><b>Level:</b> ${pet.level}</p>
            <p><b>Exp:</b> ${pet.exp}</p>
          ` : "<p>No pet data</p>"}
        </div>
      `;

      // Auto-refresh every 1 min
      setTimeout(() => trackUID(), 60000);
    }
  </script>
</head>
<body>
  <div class="container">
    <h1>üî• Free Fire UID Tracker</h1>
    <form onsubmit="trackUID(event)">
      <input type="text" name="uid" placeholder="Enter Free Fire UID" required>
      <button type="submit">Track</button>
    </form>
    <div id="result"></div>
  </div>
</body>
</html>
